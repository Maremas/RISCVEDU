<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700"
    />
    <link rel="stylesheet" href="styles.css" />
    <script type="text/javascript" src="script.js"></script>
    <title>RISC-V Processor</title>
  </head>
  <body>
    <nav class="nav">
      <h2>
        <a href="/" class="mainlogo"></a>
      </h2>
      <ul class="navlist">
        <li>
          <a class="selected" href="pipelinediagrams.html">Pipeline Diagrams</a>
        </li>
        <li><a href="datapath.html">Datapath</a></li>
        <li>
          <a href="hazards.html">Hazards</a>
          <ul class="navdropdown">
            <li><a href="structhazards.html">Structural Hazards</a></li>
            <li><a href="datahazards.html">Data Hazards</a></li>
            <li><a href="controlhazards.html">Control Hazards</a></li>
          </ul>
        </li>
      </ul>
    </nav>

    <h1>Pipeline Diagrams</h1>
    <table>
      <tbody id="exampleLeft">
        <tr>
          <td class="bubble bubblesvg" colspan="5"></td>
        </tr>
      </tbody>
    </table>

    <!-- <div id="example4-left">
      <div class="bubble bubblesvg">bubble</div>
    </div>
    <div id="example4-right">
      <div class="tinted pipelinediagram lw"></div>
      <div class="tinted pipelinediagram lw"></div>
      <div class="tinted pipelinediagram add"></div>
      <div class="tinted pipelinediagram sw"></div>
      <div class="tinted pipelinediagram lw"></div>
      <div class="tinted pipelinediagram add"></div>
      <div class="tinted pipelinediagram sw"></div>
    </div> -->
    <table id="pipelineTable">
      <thead>
        <tr>
          <th>CC 1</th>
          <th>CC 2</th>
          <th>CC 3</th>
          <th>CC 4</th>
          <th>CC 5</th>
          <th>CC 6</th>
          <th>CC 7</th>
          <th>CC 8</th>
          <th>CC 9</th>
          <th>CC 10</th>
          <th>CC 11</th>
        </tr>
      </thead>
      <tbody id="exampleRight">
        <tr>
          <td class="tinted pipelinediagram lw" colspan="5"></td>
          <td class="nodroptarget" colspan="6"></td>
        </tr>
        <tr>
          <td class="nodroptarget"></td>
          <td class="tinted pipelinediagram lw" colspan="5"></td>
          <td class="nodroptarget" colspan="5"></td>
        </tr>
        <tr>
          <td class="nodroptarget" colspan="2"></td>
          <td class="tinted pipelinediagram add" colspan="5"></td>
          <td class="nodroptarget" colspan="4"></td>
        </tr>
        <tr>
          <td class="nodroptarget" colspan="3"></td>
          <td class="tinted pipelinediagram sw" colspan="5"></td>
          <td class="nodroptarget" colspan="3"></td>
        </tr>
        <tr>
          <td class="nodroptarget" colspan="4"></td>
          <td class="tinted pipelinediagram lw" colspan="5"></td>
          <td class="nodroptarget" colspan="2"></td>
        </tr>
        <tr>
          <td class="nodroptarget" colspan="5"></td>
          <td class="tinted pipelinediagram add" colspan="5"></td>
          <td class="nodroptarget" colspan="1"></td>
        </tr>
        <tr>
          <td class="nodroptarget" colspan="6"></td>
          <td class="tinted pipelinediagram sw" colspan="5"></td>
        </tr>
      </tbody>
    </table>
    <script src="Sortable.js"></script>
    <script>
      new Sortable(exampleLeft, {
        group: {
          name: "shared",
          pull: "clone",
          put: true, // Do not allow items to be put into this list
        },
        animation: 200,
        sort: false, // To disable sorting: set sort to false
        onAdd: function (evt) {
          evt.item.remove();
        },
      });

      new Sortable(exampleRight, {
        group: "shared",
        animation: 200,
        filter: ".tinted",
        onSort: function (evt) {
          adaptTable();
        },
      });

      function adaptTable(rowOfBubble) {
        newtable = document.createElement("table");
        const table = document.getElementById("pipelineTable");
        const num_rows = table.rows.length - 1; //because of the header row
        const needed_cols = num_rows + 4;

        const originalHead = table.getElementsByTagName("thead")[0];
        const header = document.createElement("th");
        const headrow = document.createElement("tr");
        for (let col = 1; col <= needed_cols; col++) {
          const th = document.createElement("th");
          th.innerHTML = "CC " + col;
          headrow.appendChild(th);
        }
        header.appendChild(headrow);
        originalHead.innerHTML = header.innerHTML;

        const body = document.createElement("tbody");
        const originalBody = document.getElementById("exampleRight");

        for (let current_row = 1; current_row <= num_rows; current_row++) {
          const row = document.createElement("tr");

          const offsetBefore = document.createElement("td");
          offsetBefore.classList.add("offsetBefore");
          const colspanBefore = current_row - 1;
          offsetBefore.setAttribute("colspan", colspanBefore);
          if (colspanBefore > 0) {
            row.appendChild(offsetBefore);
          }

          const cells = table.rows[current_row].getElementsByTagName("td");
          for (let i = 0; i < cells.length; i++) {
            const cell = cells[i];
            if (
              cell.classList.contains("pipelinediagram") ||
              cell.classList.contains("bubblesvg")
            ) {
              cell.setAttribute("colspan", 5);
              row.appendChild(cell);
            }
          }

          const offsetAfter = document.createElement("td");
          offsetAfter.classList.add("offsetAfter");
          const colspanAfter = num_rows - current_row;
          offsetAfter.setAttribute("colspan", colspanAfter);
          if (colspanAfter > 0) {
            row.appendChild(offsetAfter);
          }
          body.appendChild(row);
        }
        originalBody.innerHTML = body.innerHTML;
      }
    </script>

    <footer>
      <p>Copyright &#169; 2024 <a href="/">My Site</a></p>
    </footer>
  </body>
</html>
